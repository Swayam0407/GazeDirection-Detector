"use strict";var f=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var P=(e,t)=>{for(var n in t)f(e,n,{get:t[n],enumerable:!0})},A=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of h(t))!T.call(e,s)&&s!==n&&f(e,s,{get:()=>t[s],enumerable:!(r=B(t,s))||r.enumerable});return e};var E=e=>A(f({},"__esModule",{value:!0}),e);var k={};P(k,{ApiError:()=>l,convertCompressedBitMapToBlob:()=>_,countBy:()=>w,getInferenceResult:()=>N,hexToRgb:()=>p,isDark:()=>S,palette:()=>b,predictionsToAnnotations:()=>v,runLengthDecode:()=>F});module.exports=E(k);var b=["#811776","#FFFF00","#00FFFF","#FF00FF","#0000FF","#FF8F20","#AD2E24","#470400","#CFF000","#A7D141","#41D1B3","#70E9FF","#00ACED","#BFD8BD","#FF70E9","#FF5C9A","#BE408F","#8670FF","#333275"];function p(e){let t={r:0,g:0,b:0};if(!e)return t;let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:t}function S(e){(typeof e=="string"||e===null||e===void 0)&&(e=p(e));let{r:t,g:n,b:r}=e;return t*.299+n*.587+r*.114<150}function v(e){var s,a;if(!e)return[];let{backbonepredictions:t,predictions:n}=e,r=(a=(s=n.bitmaps)!=null?s:t==null?void 0:t.bitmaps)!=null?a:t;return Object.entries(r||[]).map(([d,c])=>({id:d,color:b[c.labelIndex-1],coordinates:c.coordinates,bitmap:c.bitmap,name:c.labelName}))}var O={map:{Z:"0",N:"1"}},C=O.map,F=e=>e&&e.match(/(\d+)(\w|\s)/g).reduce((n,r)=>{let s=C[r.slice(-1)],a=Number(r.slice(0,r.length-1));return`${n}${s.repeat(a)}`},""),_=async(e,t,n,r)=>{let s=F(e)||"",{r:a,g:d,b:c}=p(t),m=new OffscreenCanvas(n,r),i=m.getContext("2d",{desynchronized:!0}),u=i==null?void 0:i.createImageData(n,r);for(let o=0;o<s.length;o+=1)s[o]==="1"&&(u.data[4*o+0]=a,u.data[4*o+1]=d,u.data[4*o+2]=c,u.data[4*o+3]=255*.6);return i==null||i.putImageData(u,0,0),m.convertToBlob()};var w=(e,t)=>e.reduce((n,r)=>{if(t in r){let s=r[t];s in n||(n[s]=0),n[s]++}return n},{});var l=class extends Error{constructor(n){super(n)}},N=async(e,t)=>{var d,c,m,i,u;let n=new FormData;n.append("file",t);let r=await fetch(e.endpoint+`&device_type=${(d=process.env.LIB_DEVICE_TYPE)!=null?d:"jslib"}`,{method:"POST",headers:{Accept:"*/*",...e.key?{apikey:e.key,apisecret:e.secret}:void 0},body:n}),s=await r.text(),a;try{a=JSON.parse(s);let o=(i=(c=a.predictions)==null?void 0:c.bitmaps)!=null?i:(m=a.backbonepredictions)==null?void 0:m.bitmaps;if(o)for(let g in o){let{score:x,label_name:y,label_index:D,defect_id:I,bitmap:R}=o[g];o[g]={score:x,labelName:y,labelIndex:D,defectId:I,bitmap:R}}}catch(o){}if(r.status!==200){let o=new l((u=a==null?void 0:a.message)!=null?u:s);throw o.status=r.status,o.statusText=r.statusText,o.body=a,o}return a};0&&(module.exports={ApiError,convertCompressedBitMapToBlob,countBy,getInferenceResult,hexToRgb,isDark,palette,predictionsToAnnotations,runLengthDecode});
//# sourceMappingURL=index.js.map
